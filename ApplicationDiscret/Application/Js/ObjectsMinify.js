Range.prototype.constructor=Range;function Range(b,a){if(arguments.length!=2||typeof b!="number"||typeof a!="number"||isNaN(a)||isNaN(b)){this.min=undefined;this.max=undefined}else{if(b<=a){this.min=b;this.max=a}else{console.warn("WARNING: min > max the range has been created with undefined values");this.min=undefined;this.max=undefined}}this.includeMin=true;this.includeMax=true}Range.prototype.getMin=function(){return this.min};Range.prototype.setMin=function(a){if(typeof a!="number"||isNaN(a)){throw"Range.setMin.ErrorNotANumber"}else{if(a>this.max){throw"Range.setMin.ErrorMinGreaterThanMax"}else{this.min=a}}};Range.prototype.getMax=function(){return this.max};Range.prototype.setMax=function(a){if(typeof a!="number"||isNaN(a)){throw"Range.setMax.ErrorNotANumber"}else{if(this.min>a){throw"Range.setMax.ErrorMinGreaterThanMax"}else{this.max=a}}};Range.prototype.setMinMax=function(b,a){if(typeof a!="number"||isNaN(a)||typeof b!="number"||isNaN(b)){throw"Range.setMinMax.ErrorNotANumber"}else{if(b>a){throw"Range.setMinMax.ErrorMinGreaterThanMax"}else{this.min=b;this.max=a}}};Range.prototype.getIncludeMin=function(){return this.includeMin};Range.prototype.setIncludeMin=function(a){if(typeof a!="boolean"){throw"Range.setIncludeMin.ErrorNotABoolean"}else{this.includeMin=a}};Range.prototype.getIncludeMax=function(){return this.includeMax};Range.prototype.setIncludeMax=function(a){if(typeof a!="boolean"){throw"Range.setIncludeMax.ErrorNotABoolean"}else{this.includeMax=a}};Range.prototype.isIn=function(a){if(typeof a!="number"){throw"Range.isIn.ErrorNotANumber"}if(a==this.min){return this.includeMin}else{if(a==this.max){return this.includeMax}else{return this.min<=a&&a<=this.max}}};Range.prototype.length=function(){return this.max-this.min};Range.prototype.toString=function(){return(this.includeMin?"[":"]")+this.min+"; "+this.max+(this.includeMax?"]":"[")};var x=[];x[0]="x";x[1]="y";var defaultvalue=1;Equation.prototype.constructor=Equation;function Equation(h){this.listVariables=[];this.listParameters=[];try{this.formulaTree=math.parse(h);this.formula=h}catch(b){console.error("Equation.constructor."+b.name+":"+b.message);this.formula=undefined;this.formulaTree=undefined}if(this.formulaTree!==undefined){var d=x.length;for(var c=0;c<d;c++){var a=this.formulaTree.filter(function(e){return e.isSymbolNode&&e.name===x[c]});if(a.length>0){this.listVariables.push(x[c])}}var g=this.listParameters;this.formulaTree.traverse(function(i,j,e){if(i.isSymbolNode&&i.name!=x[0]&&i.name!=x[1]){if(g[i.name]===undefined){g[i.name]=defaultvalue}}});try{this.preparedFormula=this.formulaTree.compile()}catch(f){console.log("compilation failed");console.log(this.getString())}}}Equation.prototype.setFormula=function(f){this.listVariables=[];this.listParameters=[];try{this.formulaTree=math.parse(f);this.formula=f}catch(b){this.formula=undefined;this.formulaTree=undefined;console.log(b.message);throw"Equation.setFormula."+b.name}if(this.formulaTree!==undefined){var d=x.length;for(var c=0;c<d;c++){var a=this.formulaTree.filter(function(g){return g.isSymbolNode&&g.name===x[c]});if(a.length>0){this.listVariables.push(x[c])}}var e=this.listParameters;this.formulaTree.traverse(function(h,i,g){if(h.isSymbolNode&&h.name!==x[0]&&h.name!=x[1]){if(e[h.name]===undefined){e[h.name]=defaultvalue}}});this.preparedFormula=this.formulaTree.compile()}};Equation.prototype.compute=function(valVariables){if(this.formulaTree===undefined){throw"Equation.compute.ErrorFormulaNotDefined"}else{if(this.listVariables.length!==valVariables.length){throw"Equation.compute.ErrorWrongNumberOfVariables"}}var scope=[];var length=this.listVariables.length;for(var i=0;i<length;i++){if(typeof valVariables[i]!=="number"||!Number.isFinite(valVariables[i])){throw"Equation.compute.ErrorNotANumber"}scope[this.listVariables[i]]=valVariables[i]}for(var i in this.listParameters){scope[i]=this.listParameters[i]}return this.preparedFormula.eval(scope)};Equation.prototype.setParameter=function(a,b){if(this.listParameters[a]===undefined){throw"Equation.setParameter.ErrorNotExistingParameter"}else{if(typeof b!=="number"||!Number.isFinite(b)){throw"Equation.setParameter.ErrorNotANumber"}else{this.listParameters[a]=b}}};Equation.prototype.getParameter=function(a){if(this.listParameters[a]===undefined){throw"Equation.getParameter.ErrorNotExistingParameter"}else{return this.listParameters[a]}};Equation.prototype.getAllParameters=function(){return this.listParameters};Equation.prototype.getNbVariable=function(){return this.listVariables.length};Equation.prototype.getListVariables=function(){return this.listVariables};Equation.prototype.toStringNoParam=function(){var b=this;var a=this.formulaTree.transform(function(d,e,c){if(d.isSymbolNode&&b.listParameters[d.name]!=undefined){return new math.expression.node.ConstantNode(b.listParameters[d.name])}else{return d}});return a.toString()};Equation.prototype.toString=function(){return this.formulaTree.toString()};Equation.prototype.check=function(){return this.formulaTree!=undefined};Camera.prototype.constructor=Camera;function Camera(c,h,b,g,a,e,f,d){this.eyePos=c;this.centerPos=h;this.up=b;this.width=g;this.height=a;this.fov=e||45;this.near=f||0.1;this.far=d||1000;this.viewMatrix=null;this.perspectiveProjectionMatrix=null;this.orthographicProjectionMatrix=null;this.constProjection=2.5;this.computeMatrices()}Camera.prototype.getPosition=function(){return this.eyePos};Camera.prototype.getLookAtPosition=function(){return this.centerPos};Camera.prototype.getUpDirection=function(){return this.up};Camera.prototype.getViewMatrix=function(){return this.viewMatrix};Camera.prototype.getPerspectiveProjectionMatrix=function(){return this.perspectiveProjectionMatrix};Camera.prototype.getOrthographicProjectionMatrix=function(){return this.orthographicProjectionMatrix};Camera.prototype.setFov=function(a){if(typeof a=="number"){this.fov=a;this.computeMatrices()}else{throw"Camera.setFov: parameter is not a number"}};Camera.prototype.getProjection=function(){return this.constProjection};Camera.prototype.setProjection=function(a){if(typeof a=="undefined"){this.constProjection=2.5;this.computeMatrices()}else{if(0<a){this.constProjection=a;this.computeMatrices()}}};Camera.prototype.computeMatrices=function(){this.viewMatrix=new Matrix(this.eyePos,this.centerPos,this.up);this.perspectiveProjectionMatrix=new Matrix(this.fov*Math.PI/180,this.width/this.height,this.near,this.far);var a=Math.min(this.height,this.width);this.orthographicProjectionMatrix=new Matrix(-this.constProjection*this.width/a,this.constProjection*this.width/a,-this.constProjection*this.height/a,this.constProjection*this.height/a,this.near,this.far)};Camera.prototype.zoom=function(b){this.setProjection(this.getProjection()+b);var a=new Vector(this.getPosition()).sub(this.getLookAtPosition()).normalize();this.eyePos.x+=a.x*b;this.eyePos.y+=a.y*b;this.eyePos.z+=a.z*b;this.computeMatrices()};Camera.prototype.zoomIn=function(){var a=-(0.1+this.constProjection*0.05);if((this.eyePos.x-this.centerPos.x)*(this.eyePos.x+a-this.centerPos.x)+(this.eyePos.y-this.centerPos.y)*(this.eyePos.y+a-this.centerPos.y)+(this.eyePos.z-this.centerPos.z)*(this.eyePos.z+a-this.centerPos.z)>=0){this.zoom(a)}};Camera.prototype.zoomOut=function(){if(this.constProjection<24){this.zoom(0.1+this.constProjection*0.05)}};Camera.prototype.toConsole=function(){console.log("pos:",this.eyePos.toString(),", look at:",this.centerPos.toString(),", up:",this.up.toString(),", WxH: "+this.width+"x"+this.height,", fov:",this.fov,", near:",this.near,", far: ",this.far)};Vector.prototype.constructor=Vector;var VEC_ARRAY_TYPE=(typeof Float32Array=="undefined")?Array:Float32Array;function Vector(){this.m=new VEC_ARRAY_TYPE(3);Object.defineProperty(this,"x",{get:function(){return this.m[0]},set:function(b){this.m[0]=b}});Object.defineProperty(this,"y",{get:function(){return this.m[1]},set:function(b){this.m[1]=b}});Object.defineProperty(this,"z",{get:function(){return this.m[2]},set:function(b){this.m[2]=b}});try{switch(arguments.length){case 0:return this.defaultConstructor();case 1:if(arguments[0] instanceof Array||arguments[0] instanceof Float32Array){return this.arrayToVectorConstructor(arguments[0])}else{if(typeof arguments[0]=="number"){return this.coordinateConstructor(arguments[0],arguments[0],arguments[0])}else{return this.copyConstructor(arguments[0])}}case 3:return this.coordinateConstructor(arguments[0],arguments[1],arguments[2]);default:throw"Vector constructor bad syntax"}}catch(a){console.error(a)}}Vector.prototype.defaultConstructor=function(){this.m[0]=0;this.m[1]=0;this.m[2]=0;return this};Vector.prototype.copyConstructor=function(a){if(!(a instanceof Vector)){throw"Vector: bad copy constructor call"}this.m[0]=a.m[0];this.m[1]=a.m[1];this.m[2]=a.m[2];return this};Vector.prototype.arrayToVectorConstructor=function(a){if(a.length!=3){throw"Vector: bad array length in array to vector constructor call"}return this.coordinateConstructor(a[0],a[1],a[2])};Vector.prototype.coordinateConstructor=function(a,c,b){if(isFinite(a)&&isFinite(c)&&isFinite(b)){this.m[0]=a;this.m[1]=c;this.m[2]=b;return this}else{throw"Vector: bad coordinate constructor call ("+a+"; "+c+"; "+b+")"}};Vector.prototype.getLength=function(){return Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2])};Vector.prototype.getGLVector=function(){return this.m};Vector.prototype.add=function(a){if(!a instanceof Vector){throw"Vector.add: given parameter is not a Vector"}this.m[0]+=a.m[0];this.m[1]+=a.m[1];this.m[2]+=a.m[2];return this};Vector.prototype.sub=function(a){if(!a instanceof Vector){throw"Vector.sub: given parameter is not a Vector"}this.m[0]-=a.m[0];this.m[1]-=a.m[1];this.m[2]-=a.m[2];return this};Vector.prototype.cross=function(a){if(!a instanceof Vector){throw"Vector.cross: given parameter is not a Vector"}return new Vector(this.m[1]*a.m[2]-this.m[2]*a.m[1],this.m[2]*a.m[0]-this.m[0]*a.m[2],this.m[0]*a.m[1]-this.m[1]*a.m[0])};Vector.prototype.dot=function(a){if(!a instanceof Vector){throw"Vector.dot: given parameter is not a Vector"}return this.m[0]*a.m[0]+this.m[1]*a.m[1]+this.m[2]*a.m[2]};Vector.prototype.mul=function(a){if(isFinite(a)){this.m[0]*=a;this.m[1]*=a;this.m[2]*=a;return this}else{console.trace();throw"Vector.mul: bad parameter"}};Vector.prototype.normalize=function(){var a=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2]);if(a!==0){this.m[0]/=a;this.m[1]/=a;this.m[2]/=a}return this};Vector.prototype.invert=function(){this.m[0]=-this.m[0];this.m[1]=-this.m[1];this.m[2]=-this.m[2];return this};Vector.prototype.rotateX=function(a){return new Vector(this.m[0],this.m[1]*Math.cos(a)-this.m[2]*Math.sin(a),this.m[1]*Math.sin(a)+this.m[2]*Math.cos(a))};Vector.prototype.rotateY=function(a){return new Vector(this.m[0]*Math.cos(a)-this.m[2]*Math.sin(a),this.m[1],this.m[0]*Math.sin(a)+this.m[2]*Math.cos(a))};Vector.prototype.rotateZ=function(a){return new Vector(this.m[0]*Math.cos(a)-this.m[1]*Math.sin(a),this.m[0]*Math.sin(a)+this.m[1]*Math.cos(a),this.m[2])};Vector.prototype.toString=function(){return"["+this.m[0]+"; "+this.m[1]+"; "+this.m[2]+"]"};Vector.prototype.isNul=function(){return this.m[0]===0&&this.m[1]===0&&this.m[2]===0};Vector.prototype.equals=function(a){if(!a instanceof Vector){throw"Vector.sub: given parameter is not a Vector"}return this.m[0]===vect.m[0]&&this.m[1]===vect.m[1]&&this.m[2]===vect.m[2]};function addVector(d,c){if(!checkType(arguments,[Vector,Array,"number"],[Vector,Array,"number"])){throw"addVector: one of parameter is not a Vector"}var f=new Vector(d);var e=new Vector(c);return f.add(e)};Matrix.prototype=new Object;Matrix.prototype.constructor=Matrix;var MAT_ARRAY_TYPE=(typeof Float32Array=="undefined")?Array:Float32Array;function Matrix(){switch(arguments.length){case 0:return this.defaultConstructor();case 1:return this.copyConstructor(arguments[0]);case 3:return this.createLookAt(arguments[0],arguments[1],arguments[2]);case 4:return this.createPerspective(arguments[0],arguments[1],arguments[2],arguments[3]);case 6:return this.createOrthographic(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);default:throw"Bad Matrix constructor call"}return this}Matrix.prototype.defaultConstructor=function(){this.m=new MAT_ARRAY_TYPE(16);for(var b=0;b<4;++b){for(var a=0;a<4;++a){this.set(b,a,b==a?1:0)}}};Matrix.prototype.copyConstructor=function(b){if(b instanceof Matrix){this.m=new MAT_ARRAY_TYPE(16);for(var a=0;a<16;++a){this.m[a]=b.m[a]}}else{throw"Matrix: bad copy constructor call"}};Matrix.prototype.createLookAt=function(d,b,a){if(!checkType(arguments,Vector,Vector,Vector)){throw"Matrix.createLookAt: bad parameter"}var g=new Vector(b).sub(d).normalize();var e=g.cross(a).normalize();var f=e.cross(g).normalize();this.m=new MAT_ARRAY_TYPE(16);this.m[0]=e.x;this.m[1]=f.x;this.m[2]=-g.x;this.m[3]=0;this.m[4]=e.y;this.m[5]=f.y;this.m[6]=-g.y;this.m[7]=0;this.m[8]=e.z;this.m[9]=f.z;this.m[10]=-g.z;this.m[11]=0;this.m[12]=-e.dot(d);this.m[13]=-f.dot(d);this.m[14]=g.dot(d);this.m[15]=1;return this};Matrix.prototype.createPerspective=function(b,e,d,a){if(!checkType(arguments,"number","number","number","number")){throw"Matrix.createPerspective: one of parameters is not a number"}this.m=new MAT_ARRAY_TYPE(16);var h=1/Math.tan(b/2);var g=1/(d-a);this.m[0]=h/e;this.m[1]=0;this.m[2]=0;this.m[3]=0;this.m[4]=0;this.m[5]=h;this.m[6]=0;this.m[7]=0;this.m[8]=0;this.m[9]=0;this.m[10]=(d+a)*g;this.m[11]=-1;this.m[12]=0;this.m[13]=0;this.m[14]=d*a*g*2;this.m[15]=0;return this};Matrix.prototype.createOrthographic=function(b,i,a,h,g,f){if(!checkType(arguments,"number","number","number","number","number","number")){throw"Matrix.createOrthographic: one of parameters is not a number"}this.m=new MAT_ARRAY_TYPE(16);var e=1/(b-i),j=1/(a-h),d=1/(g-f);this.m[0]=-2*e;this.m[1]=0;this.m[2]=0;this.m[3]=0;this.m[4]=0;this.m[5]=-2*j;this.m[6]=0;this.m[7]=0;this.m[8]=0;this.m[9]=0;this.m[10]=2*d;this.m[11]=0;this.m[12]=(b+i)*Math.min(e,j);this.m[13]=(h+a)*Math.min(e,j);this.m[14]=(f+g)*d;this.m[15]=1;return this};Matrix.prototype.get=function(b,a){if(b<0||b>=4){throw"Matrix getter: bad line value ("+b+")"}if(a<0||a>=4){throw"Matrix getter: bad column value ("+a+")"}return this.m[b+4*a]};Matrix.prototype.set=function(d,b,a){if(d<0||d>=4){throw"Matrix setter: bad line value ("+d+")"}if(b<0||b>=4){throw"Matrix setter: bad column value ("+b+")"}this.m[d+b*4]=a};Matrix.prototype.degToRad=function(a){return((a)*0.017453292519943295)};Matrix.prototype.getGLVector=function(){return this.m};Matrix.prototype.toString=function(){var a="";for(l=0;l<4;++l){a+="[";for(c=0;c<3;++c){a+=this.get(l,c)+", "}a+=this.get(l,3)+"]\n"}return a};Matrix.prototype.toNormal=function(){this.m[3]=this.m[7]=this.m[11]=0;this.m[12]=this.m[13]=this.m[14]=this.m[15]=0;var t=this.m[0];var s=this.m[4];var r=this.m[8];var q=this.m[1];var p=this.m[5];var o=this.m[9];var n=this.m[2];var m=this.m[6];var j=this.m[10];var k=1/(t*(p*j-m*o)+q*(r*m-j*s)+n*(s*o-p*r));this.m[0]=(p*j-o*m)*k;this.m[1]=(r*m-s*j)*k;this.m[2]=(s*o-r*p)*k;this.m[4]=(o*n-q*j)*k;this.m[5]=(t*j-r*n)*k;this.m[6]=(r*q-t*o)*k;this.m[8]=(q*m-p*n)*k;this.m[9]=(s*n-t*m)*k;this.m[10]=(t*p-s*q)*k;return this};Matrix.prototype.apply=function(d){if(!d instanceof Vector){throw ("Matrix.apply: bad parameter")}var b=1/this.m[15];var a=d.m[0]*b;var f=d.m[1]*b;var e=d.m[2]*b;return new Vector(this.m[0]*a+this.m[4]*f+this.m[8]*e+this.m[12]*b,this.m[1]*a+this.m[5]*f+this.m[9]*e+this.m[13]*b,this.m[2]*a+this.m[6]*f+this.m[10]*e+this.m[14]*b)};Matrix.prototype.toConsole=function(){for(var a=0;a<4;a++){console.log("["+this.m[a]+" "+this.m[4+a]+" "+this.m[8+a]+" "+this.m[12+a]+"]")}};Matrix.prototype.equals=function(b){var d=(arguments.length==2)?arguments[1]:0;if((!b instanceof Matrix)||(!isFinite(d))){throw ("Matrix equals: bad parameter")}for(var a=0;a<16;++a){if(Math.abs(this.m[a]-b.m[a])>d){return false}}return true};Matrix.prototype.add=function(b){if(!(b instanceof Matrix)){throw"Matrix addition: bad parameter!"}for(var a=0;a<16;++a){this.m[a]+=b.m[a]}return this};Matrix.prototype.mul=function(g){if(!(g instanceof Matrix)){throw"Matrix multiplication: given parameter is not a Matrix"}var f=new MAT_ARRAY_TYPE(this.m);for(var e=0;e<4;++e){for(var d=0;d<4;++d){var b=0;for(var a=0;a<4;++a){b+=f[e+4*a]*g.get(a,d)}this.set(e,d,b)}}return this};Matrix.prototype.transpose=function(){for(var a=0;a<4;++a){for(var d=a+1;d<4;++d){var b=this.get(a,d);this.set(a,d,this.get(d,a));this.set(d,a,b)}}return this};Matrix.prototype.invert=function(){var C=this.m[0],A=this.m[1],y=this.m[2],x=this.m[3];var e=this.m[4],d=this.m[5],b=this.m[6],a=this.m[7];var t=this.m[8],s=this.m[9],r=this.m[10],q=this.m[11];var E=this.m[12],D=this.m[13],B=this.m[14],z=this.m[15];var p=C*d-A*e;var o=C*b-y*e;var n=C*a-x*e;var m=A*b-y*d;var k=A*a-x*d;var j=y*a-x*b;var i=t*D-s*E;var h=t*B-r*E;var g=t*z-q*E;var f=s*B-r*D;var w=s*z-q*D;var v=r*z-q*B;var u=1/(p*v-o*w+n*f+m*g-k*h+j*i);this.m[0]=(d*v-b*w+a*f)*u;this.m[1]=(-A*v+y*w-x*f)*u;this.m[2]=(D*j-B*k+z*m)*u;this.m[3]=(-s*j+r*k-q*m)*u;this.m[4]=(-e*v+b*g-a*h)*u;this.m[5]=(C*v-y*g+x*h)*u;this.m[6]=(-E*j+B*n-z*o)*u;this.m[7]=(t*j-r*n+q*o)*u;this.m[8]=(e*w-d*g+a*i)*u;this.m[9]=(-C*w+A*g-x*i)*u;this.m[10]=(E*k-D*n+z*p)*u;this.m[11]=(-t*k+s*n-q*p)*u;this.m[12]=(-e*f+d*h-b*i)*u;this.m[13]=(C*f-A*h+y*i)*u;this.m[14]=(-E*m+D*o-B*p)*u;this.m[15]=(t*m-s*o+r*p)*u;return this};Matrix.prototype.translate=function(a){if(!a instanceof Vector){throw"Matrix translate: given parameter is not a Vector"}this.m[12]+=a.m[0]*this.m[15];this.m[13]+=a.m[1]*this.m[15];this.m[14]+=a.m[2]*this.m[15];return this};Matrix.prototype.scale=function(d){if(!isFinite(d)){throw"Matrix scale: given parameter is not a finite number"}for(var b=0;b<3;++b){for(var a=0;a<4;++a){this.m[b+a*4]*=d}}return this};Matrix.prototype.rotateX=function(f){var g=Math.cos(f);var e=Math.sin(f);for(var d=0;d<4;++d){var b=this.get(1,d);var a=this.get(2,d);this.set(1,d,g*b-e*a);this.set(2,d,e*b+g*a)}return this};Matrix.prototype.rotateY=function(f){var g=Math.cos(f);var e=Math.sin(f);for(var d=0;d<4;d++){var b=this.get(0,d);var a=this.get(2,d);this.set(0,d,g*b+e*a);this.set(2,d,-e*b+g*a)}return this};Matrix.prototype.rotateZ=function(f){var g=Math.cos(f);var e=Math.sin(f);for(var d=0;d<4;++d){var b=this.get(0,d);var a=this.get(1,d);this.set(0,d,g*b-e*a);this.set(1,d,e*b+g*a)}return this};Matrix.prototype.rotate=function(e,a){var g=Math.cos(e);var b=Math.sin(e);var d=new Matrix();var f=new Vector(a).normalize();d.m[0]=f.x*f.x*(1-g)+g;d.m[1]=f.x*f.y*(1-g)-f.z*b;d.m[2]=f.x*f.z*(1-g)+f.y*b;d.m[4]=f.y*f.x*(1-g)+f.z*b;d.m[5]=f.y*f.y*(1-g)+g;d.m[6]=f.y*f.z*(1-g)-f.x*b;d.m[8]=f.z*f.x*(1-g)-f.y*b;d.m[9]=f.z*f.y*(1-g)+f.x*b;d.m[10]=f.z*f.z*(1-g)+g;d.mul(this);this.m=d.m;return this};Matrix.prototype.shearing=function(b,e,a){if(e<0||e>3||b<0||b>3||e==b){throw"Matrix.shearing: bad type(s) of parameter(s)"}for(var d=0;d<4;++d){this.set(e,d,this.get(e,d)+a*this.get(b,e))}return this};Matrix.prototype.getXVector=function(){return new Vector(this.m[0],this.m[1],this.m[2])};Matrix.prototype.getYVector=function(){return new Vector(this.m[4],this.m[5],this.m[6])};Matrix.prototype.getZVector=function(){return new Vector(this.m[8],this.m[9],this.m[10])};Point.prototype=new Vector;Point.prototype.constructor=Point;function Point(){Vector.call(this);switch(arguments.length){case 0:return this.defaultConstructor();case 1:if(arguments[0] instanceof Array){return this.arrayToPointConstructor(arguments[0])}else{if(typeof arguments[0]=="number"){return this.coordinateConstructor(arguments[0],arguments[0])}else{return this.copyConstructor(arguments[0])}}case 2:return this.coordinateConstructor(arguments[0],arguments[1]);default:throw"Point constructor bad syntax"}return this}Point.prototype.defaultConstructor=function(){this.m[0]=0;this.m[1]=0;this.m[2]=0;return this};Point.prototype.copyConstructor=function(a){if(!(a instanceof Point)){throw ("Point: bad copy constructor call")}this.m[0]=a.m[0];this.m[1]=a.m[1];return this};Point.prototype.arrayToPointConstructor=function(a){if(a.length!=2){throw"Point : bad array length in array to vector constructor call"}return this.coordinateConstructor(a[0],a[1])};Point.prototype.coordinateConstructor=function(a,b){if(isFinite(a)&&isFinite(b)){this.m[0]=a;this.m[1]=b;return this}else{throw"Point: bad (by coordinate) constructor call ("+a+", "+b+", "+z+")"}};Point.prototype.X=function(){return this.m[0]};Point.prototype.Y=function(){return this.m[1]};Point.prototype.Z=function(){throw"Point.Z : aucune coordinate"};Point.prototype.sub=function(a){this.m[0]-=a.m[0];this.m[1]-=a.m[1];this.m[2]-=a.m[2];return this};Point.prototype.cross=function(a){throw"Point.cross : not yet implemented"};Point.prototype.rotateX=function(a){throw"Point.rotateX : not yet implemented"};Point.prototype.rotateY=function(a){throw"Point.rotateY : not yet implemented"};Point.prototype.rotateZ=function(a){throw"Point.rotateZ : impossible"};Point.prototype.getGLVector=function(){return this.m};Point.prototype.toString=function(){return"["+this.m[0]+"; "+this.m[1]+"]"};function addPoint(d,c){if((!(d instanceof Point)&&!(d instanceof Array))||(!(c instanceof Point)&&!(c instanceof Array))){throw"addPoint : one of term is not a Point"}var f=new Point(d);var e=new Point(c);return f.add(e)};Voxel.prototype.constructor=Voxel;function Voxel(c,b){if(!c instanceof Vector){console.error("Voxel.constructor: bad type(s) of parameter(s)")}this.position=c;this.faces=[];for(var a=0;a<DirectionEnum.size;++a){this.faces.push(ConnexityEnum.NULL)}this.neighborVisibility=[];for(var a=0;a<DirectionEnum.size;++a){this.faces.push(true)}this.connexity=b;this.visibility=true}Voxel.prototype.getPosition=function(){return this.position};Voxel.prototype.getConnexity=function(){return this.connexity};Voxel.prototype.isVisible=function(a){return this.visibility&&(this.connexity&a)};Voxel.prototype.isHidden=function(c){var a=false;for(var b=0;(!a)&&b<DirectionEnum.size;++b){a=a||!(this.neighborVisibility[b]&&this.faces[b]&c)}return !a};Voxel.prototype.hasFacet=function(a,b){if(!checkType(arguments,"number","number")){throw"Voxel.hasFacet: bad type(s) of parameter(s)"}return !(this.neighborVisibility[a]&&this.faces[a]&b)};Voxel.prototype.addFacetConnexity=function(a,b){if(!checkType(arguments,"number","number")){throw"Voxel.addFacetConnexity: bad type(s) of parameter(s)"}this.faces[a]=this.faces[a]|b};Voxel.prototype.removeFacetConnexity=function(a,b){if(!checkType(arguments,"number","number")){throw"Voxel.removeFacetConnexity: bad type(s) of parameter(s)"}this.faces[a]=this.faces[a]&!b};Facet.prototype.constructor=Facet;function Facet(a,b){if(!checkType(arguments,Vector,"number")){console.error("Facet.constructor: bad type(s) of parameter(s)")}this.cubeCoor=a;this.direction=b}Facet.prototype.getCube=function(){return this.cubeCoor};Facet.prototype.getDirection=function(){return this.direction};Facet.prototype.egale=function(a){if(a){return(this.cubeCoor.m[0]==a.cubeCoor.m[0]&&this.cubeCoor.m[1]==a.cubeCoor.m[1]&&this.cubeCoor.m[2]==a.cubeCoor.m[2]&&this.direction==a.direction)}else{return false}};Facet.prototype.toString=function(){return"position: "+this.cubeCoor.toString()+", direction: "+DirectionEnum.toString(this.direction)};Surface.prototype.constructor=Surface;function Surface(b){if(!b instanceof Vector){console.error("Surface.constructor: parameter is not a Vector")}this.dimension=new Vector(b);this.matVoxel=[];for(var a=0;a<this.dimension.x;++a){this.matVoxel[a]=[];for(var d=0;d<this.dimension.y;++d){this.matVoxel[a][d]=[];for(var c=0;c<this.dimension.z;++c){this.matVoxel[a][d][c]=null}}}this.nbVoxel=0}Surface.prototype.getVoxel=function(b,d,c){var a,f,e;if(b instanceof Vector){a=b.x;f=b.y;e=b.z}else{if(b instanceof Array&&b.length>=3){a=b[0];f=b[1];e=b[2]}else{if(checkType(arguments,"number","number","number")){a=b;f=d;e=c}else{throw"Surface.getVoxel: bad type(s) of parameter(s)"}}}return(this.isIn(a,f,e))?this.matVoxel[a][f][e]:null};Surface.prototype.addVoxel=function(d,b){if(!checkType(arguments,Vector,"number")){throw"Surface.addVoxel: bad type(s) of parameter(s)"}var g=d.x;var f=d.y;var e=d.z;if(this.isIn(g,f,e)){if(this.matVoxel[g][f][e]===null){this.matVoxel[g][f][e]=new Voxel(d,b);this.nbVoxel++}else{this.matVoxel[g][f][e].connexity|=b}var k=DirectionEnum.size;for(var c=0;c<k;++c){var a=g+DirectionEnum.properties[c].x;var j=f+DirectionEnum.properties[c].y;var h=e+DirectionEnum.properties[c].z;if(this.isIn(a,j,h)&&this.matVoxel[a][j][h]!==null){this.matVoxel[g][f][e].addFacetConnexity(c,this.matVoxel[a][j][h].getConnexity());this.matVoxel[a][j][h].addFacetConnexity(DirectionEnum.properties[c].oppose,b)}}}else{console.error("out of bound:",g,f,e);throw"Surface.addVoxel.OutOfBounds"}};Surface.prototype.voxelHasFacet=function(h,d,b){var g=this.getVoxel(h);var a=h.x+DirectionEnum.properties[d].x,f=h.y+DirectionEnum.properties[d].y,e=h.z+DirectionEnum.properties[d].z;var c=(this.isIn(a,f,e))?this.getVoxel(a,f,e):null;return(c==null||!c.visibility||(g.getConnexity()<c.getConnexity()&&c.getConnexity()>b))};Surface.prototype.isIn=function(a,c,b){if(!checkType(arguments,"number","number","number")){throw"Surface.isIn.ErrorNotANumber"}return(a>=0&&a<this.dimension.x&&c>=0&&c<this.dimension.y&&b>=0&&b<this.dimension.z)};Surface.prototype.getDimension=function(){return this.dimension};Surface.prototype.clear=function(){for(var a=0;a<this.dimension.x;++a){for(var c=0;c<this.dimension.y;++c){for(var b=0;b<this.dimension.z;++b){this.matVoxel[a][c][b]=null}}}this.nbVoxel=0};Surface.prototype.getNbNeighbor=function(c){if(!c instanceof Vector){throw"Surface.getNbNeighbor.ErrorNotAVector"}var b=0;var e=DirectionEnum.size;for(var d=0;d<e;++d){var a=c.x+DirectionEnum.properties[d].x;var g=c.y+DirectionEnum.properties[d].y;var f=c.z+DirectionEnum.properties[d].z;if(this.isIn(a,g,f)&&this.matVoxel[a][g][f]!==null){++b}}return b};Surface.prototype.getNbVoxel=function(){return this.nbVoxel};Surface.prototype.setVoxelVisibility=function(b,c){if(!checkType(arguments,Vector,"boolean")){throw"Surface.setVoxelVisibility: bad type(s) of parameter(s)"}var a=b.x;var e=b.y;var d=b.z;if(this.isIn(a,e,d)){this.matVoxel[a][e][d].visibility=c}else{throw"Surface.setVoxelVisibility.OutOfBounds"}};Surface.prototype.isVoxelVisible=function(b,d,c){var a,f,e;if(b instanceof Vector){a=b.x;f=b.y;e=b.z}else{if(b instanceof Array&&b.length>=3){a=b[0];f=b[1];e=b[2]}else{if(checkType(arguments,"number","number","number")){a=b;f=d;e=c}else{throw"Surface.getVoxel: bad type(s) of parameter(s)"}}}if(this.isIn(a,f,e)){return this.matVoxel[a][f][e].isVisible()}else{throw"Surface.isVoxelVisible.OutOfBounds"}};Surface.prototype.slice=function(e,c){if(!(e instanceof Range)){throw"Surface.slice.ErrorNotARange"}var b,h,g,f,d,a,k,j;for(h=0;h<this.dimension.x;++h){for(g=0;g<this.dimension.y;++g){for(f=0;f<this.dimension.z;++f){switch(c){case AxisEnum.X:b=e.isIn(h);break;case AxisEnum.Y:b=e.isIn(g);break;case AxisEnum.Z:b=e.isIn(f);break;default:b=false;break}if(this.matVoxel[h][g][f]!==null){this.matVoxel[h][g][f].visibility=b;for(d=0;d<DirectionEnum.size;++d){a=h+DirectionEnum.properties[d].x;k=g+DirectionEnum.properties[d].y;j=f+DirectionEnum.properties[d].z;if(this.isIn(a,k,j)&&this.matVoxel[a][k][j]!==null){this.matVoxel[a][k][j].neighborVisibility[DirectionEnum.properties[d].oppose]=b}}}}}}};Surface.prototype.printOnly=function(e,c,b){if(!checkType(arguments,Range,Range,Range)){throw"Surface.printOnly.ErrorNotARange"}var d,j,h,g,f,a,l,k;for(j=0;j<this.dimension.x;++j){for(h=0;h<this.dimension.y;++h){for(g=0;g<this.dimension.z;++g){voxel=this.matVoxel[j][h][g];if(voxel!==null){d=e.isIn(j)&&c.isIn(h)&&b.isIn(g);voxel.visibility=d;for(f=0;f<DirectionEnum.size;++f){a=j+DirectionEnum.properties[f].x;l=h+DirectionEnum.properties[f].y;k=g+DirectionEnum.properties[f].z;if(this.isIn(a,l,k)&&this.matVoxel[a][l][k]!==null){this.matVoxel[a][l][k].neighborVisibility[DirectionEnum.properties[f].oppose]=d}}}}}}};Surface.prototype.setConnexity=function(c){if(!isValueOfEnum(ConnexityEnum,c)){throw"Surface.setConnexity.ErrorNotAConnexity"}var b;for(var a=0;a<this.dimension.x;++a){for(var e=0;e<this.dimension.y;++e){for(var d=0;d<this.dimension.z;++d){b=this.matVoxel[a][e][d];if(b!=null&&b.connexity|c){b.visibility=true}}}}};Surface.prototype.getZSlice=function(f){var e=this.getDimension();var h=new Controller3D(e);var d=h.newSurface();var a,g,b;for(a=0;a<e.x;++a){for(g=0;g<e.y;++g){b=this.getVoxel(a,g,f);if(b){d.addVoxel(b.getPosition(),b.getConnexity())}}}console.log("surface",d);return h};Surface.prototype.getYSlice=function(h){var e=this.getDimension();var g=new Controller3D(e);var d=g.newSurface();var a,f,b;for(a=0;a<e.x;++a){for(f=0;f<e.z;++f){b=this.getVoxel(a,h,f);if(b){d.addVoxel(b.getPosition(),b.getConnexity())}}}return g};Curve.prototype.constructor=Curve;function Curve(){}Curve.prototype.computePoints=function(b,a){throw"Curve.computePoints.ErrorNotImplementedInAbstractClass"};Curve.prototype.setParameter=function(b,a){throw"Curve.setParameter.ErrorNotImplementedInAbstractClass"};Curve.prototype.getAllParameters=function(){throw"Curve.setParameter.ErrorNotImplementedInAbstractClass"};Curve.prototype.getParameter=function(a){throw"Curve.setParameter.ErrorNotImplementedInAbstractClass"};Curve.prototype.getParametersRange=function(a){throw"Curve.getParametersRange.ErrorNotImplementedInAbstractClass"};FormulaCurve.prototype=new Curve;FormulaCurve.prototype.constructor=FormulaCurve;function FormulaCurve(a){if(arguments.length===0){this.equation=undefined}else{if(typeof a=="string"){this.equation=new Equation(a)}else{if(a instanceof Equation){this.equation=a}else{this.equation=undefined}}}this.parametersRange=[]}FormulaCurve.prototype.getEquation=function(){return this.equation};FormulaCurve.prototype.getEquationNoParameter=function(){return this.equation.toStringNoParam()};FormulaCurve.prototype.getParametersRange=function(a){return this.parametersRange[a]};FormulaCurve.prototype.setEquation=function(a){if(typeof a=="string"){this.equation=new Equation(a)}else{if(a instanceof Equation){this.equation=a}else{throw"FormulaCurve.setEquation.ErrorNotAnEquation"}}};FormulaCurve.prototype.computeStep=function(b,a){return 0.1};FormulaCurve.prototype.setParameter=function(b,a){this.equation.setParameter(b,a)};FormulaCurve.prototype.getAllParameters=function(){return this.equation.getAllParameters()};ExplicitCurve.prototype=new FormulaCurve();ExplicitCurve.prototype.constructor=ExplicitCurve;function ExplicitCurve(a){FormulaCurve.call(this,a)}ExplicitCurve.prototype.computePoints=function(d,c){if(!d instanceof Range||!c instanceof Range){throw"ExplicitCurve.computePoints.ErrorNotARange"}else{if(!this.equation.check){throw"ExplicitCurve.computePoints.ErrorEquationNotDefined"}}var i=[];var h=[];var a=d.getMin();var e=d.getMax();var b=this.computeStep();for(var g=a;g<=e;g+=b){var f=this.equation.compute([g]);if(c.isIn(f)){h.push(new Point(g,f))}else{if(h.length>0){i.push(h.slice(0));h=[]}}}if(h.length>0){i.push(h.slice(0))}return i};ExplicitCurve.prototype.computeRange=function(){return new Range(-10,10)};ImplicitCurve.prototype=new FormulaCurve;ImplicitCurve.prototype.constructor=ImplicitCurve;function ImplicitCurve(a){FormulaCurve.call(this,a)}ImplicitCurve.prototype.computePoints=function(e,d){if(!e instanceof Range||!d instanceof Range){throw"ImplicitCurve.computePoints.ErrorNotARange"}else{if(!this.equation.check){throw"ImplicitCurve.computePoints.ErrorEquationNotDefined"}}var l=[];var j=[];var a=e.getMin();var f=e.getMax();var k=d.getMin();var c=d.getMax();var b=this.computeStep(e,d);for(var i=a;i<=f;i+=b){for(var g=k;g<=c;g+=b){var h=this.equation.compute([i,g]);if(h>-0.5&&h<0.5){j.push(new Point(i,g))}else{if(j.length>0){l.push(j.slice(0));j=[]}}}}if(j.length>0){l.push(j.slice(0))}return l};DrawnCurve.prototype=new Curve;DrawnCurve.prototype.constructor=DrawnCurve;function DrawnCurve(){Curve.call(this);this.xList=[];this.yList=[]}DrawnCurve.prototype.getMaxT=function(){return this.xList.length};DrawnCurve.prototype.getXList=function(){return this.xList};DrawnCurve.prototype.getYList=function(){return this.yList};DrawnCurve.prototype.getX=function(a){if(typeof a!="number"&&Number.isFinite(a)){throw"DrawnCurve.getX: bad value of given parameter"}if(Number.isInteger(a)){return this.xList[a]}else{return interpol(a,this.xList)}};DrawnCurve.prototype.getY=function(a){if(typeof a!="number"&&Number.isFinite(a)){throw"DrawnCurve.getY: bad value of given parameter"}if(Number.isInteger(a)){return this.yList[a]}else{return interpol(a,this.yList)}};DrawnCurve.prototype.addPoint=function(j,f){var d=this.xList.length;if(d==0){this.xList.push(j);this.yList.push(f)}else{var b=this.xList[d-1],a=this.yList[d-1];var h=Math.abs(b-j),g=Math.abs(a-f);var e=Math.max(h,g);if(e>1){for(var c=1;c<=Math.floor(e);++c){this.xList.push(b+(c/e)*-(b-j));this.yList.push(a+(c/e)*-(a-f))}}this.xList.push(j);this.yList.push(f)}};DrawnCurve.prototype.setParameter=function(){throw"DrawnCurve.setParameter.ErrorCannotModifyParameterOnDrawnCurve"};function interpol(a,b){if(a<=0){return b[0]}else{if(a>=b.length-1){return b[b.length-1]}else{var d=b[Math.floor(a)];var c=b[Math.floor(a)+1];tPerc=a-Math.floor(a);return(1-tPerc)*d+tPerc*c}}};GenericStructure.prototype.constructor=GenericStructure;function GenericStructure(a,b){if(arguments.length!=0&&!(typeof a=="string"&&b instanceof Shader)){console.error("GenericStructure.constructor: bad type(s) of parameter(s)");showType(a,b);return}this.structureName=a;this.matrix=new Matrix();this.shader=b;this.isDisplayable=true;this.isPickable=true;this.glVertexBuffer=[];this.glBackBuffer=[];this.glIndicesBuffer=[];this.prepared=false}GenericStructure.prototype.getModelController=function(){return this.modelController};GenericStructure.prototype.setModelController=function(a){if(a instanceof Controller){this.modelController=a}else{throw"GenericStructure.setModelController: parameter is not a Controller"}};GenericStructure.prototype.getName=function(){return this.structureName};GenericStructure.prototype.setName=function(a){if(typeof a=="string"){this.structureName=a}else{throw"GenericStructure.setName: argument is not a string"}};GenericStructure.prototype.getMatrix=function(){return this.matrix};GenericStructure.prototype.setMatrix=function(a){if(a instanceof Matrix){this.matrix=a}else{throw"GenericStructure.setMatrix: argument is not a Matrix"}};GenericStructure.prototype.getShader=function(){return this.shader};GenericStructure.prototype.setShader=function(a){if(a instanceof Shader){this.shader=a}else{throw"GenericStructure.setShader: argument is not a Shader"}};GenericStructure.prototype.displayMe=function(){return this.isDisplayable};GenericStructure.prototype.setDisplay=function(a){if(typeof(a)==="boolean"){this.isDisplayable=a}else{throw"GenericStructure.setDisplay: argument is not a boolean"}};GenericStructure.prototype.isPickable=function(){return this.isPickable};GenericStructure.prototype.setPickable=function(a){if(typeof(a)=="boolean"){this.isPickable=a}else{throw"GenericStructure.setPickable: parameter is not a boolean"}};GenericStructure.prototype.isPrepared=function(){return this.prepared};GenericStructure.prototype.unprepare=function(){this.prepared=false};GenericStructure.prototype.prepare=function(b,a){};GenericStructure.prototype.draw=function(a){};GenericStructure.prototype.drawBackBuffer=function(a){};GenericStructure.prototype.addAPoint=function(a,d,c,b){if(!this.shader.hasAttribute(AttributeEnum.position)){return 0}if(d instanceof Array){a.push(d[0],d[1],d[2])}else{if(b===undefined){throw"GenericObject.addAPoint: missing parameter (typeof X: "+typeof d+")"}else{a.push(d,c,b)}}return 3};GenericStructure.prototype.addAColor=function(d,c,b,e,a){if(!this.shader.hasAttribute(AttributeEnum.color)){return 0}if(c instanceof Array){d.push(c[0],c[1],c[2],c[3])}else{if(a===undefined){throw"GenericObject.addAColor: missing parameter (typeof R: "+typeof c+")"}else{d.push(c,b,e,a)}}return 4};GenericStructure.prototype.addANormal=function(a,d,c,b){if(!this.shader.hasAttribute(AttributeEnum.normal)){return 0}if(d instanceof Array){a.push(d[0],d[1],d[2])}else{if(b===undefined){throw"GenericObject.addANormal: missing parameter (typeof X: "+typeof d+")"}else{a.push(d,c,b)}}return 3};GenericStructure.prototype.addATangent=function(a,d,c,b){if(!this.shader.hasAttribute(AttributeEnum.tangent)){return 0}if(d instanceof Array){a.push(d[0],d[1],d[2])}else{if(b===undefined){throw"GenericObject.addATangent: missing parameter (typeof X: "+(typeof d)+")"}else{a.push(d,c,b)}}return 3};GenericStructure.prototype.addABitangent=function(a,d,c,b){if(!this.shader.hasAttribute(AttributeEnum.bitangent)){return 0}if(d instanceof Array){a.push(d[0],d[1],d[2])}else{if(b===undefined){throw"GenericObject.addABitangent: missing parameter (typeof X: "+typeof d+")"}else{a.push(d,c,b)}}return 3};GenericStructure.prototype.addTextureCoordinates=function(c,b,a){if(!this.shader.hasAttribute(AttributeEnum.texcoord)){return 0}if(b instanceof Array){c.push(b[0],b[1])}else{if(a===undefined){throw"GenericObject.addTextureCoordinates: missing parameter "+ +"(typeof U: "+typeof b+")"}else{c.push(b,a)}}return 2};Repere.prototype=new GenericStructure;Repere.prototype.constructor=Repere;function Repere(a){GenericStructure.call(this,"repere",new DefaultShader(a));this.dimension=new Vector(1,1,1);this.isPickable=false;this.matrix.scale(0.01)}Repere.prototype.getDimension=function(){return this.dimension};Repere.prototype.getMatrix=function(c){if(!checkType(arguments,Camera)){throw"Repere.getMatrix: Given parameter is not a Camera"}var e=new Matrix().rotateZ(getAzimuth(c.getPosition(),c.getLookAtPosition()));e.rotate(getAltitude(c.getPosition(),c.getLookAtPosition()),e.getYVector());var d=0.083/c.height;var b=new Vector(c.getPosition()).sub(c.getLookAtPosition()).normalize();var a=e.getYVector().mul(-c.width*d);var f=e.getZVector().mul(-c.height*d);b=new Vector(c.getPosition()).sub(b.mul(0.2)).add(a).sub(new Vector(a).mul(0.12)).add(f).sub(new Vector(f).mul(0.12));return new Matrix(this.matrix).translate(b)};Repere.prototype.prepare=function(b){var c=[[0.1,0,0.095],[0.7,0,0.095],[0.7,-0.1,0.195],[1,0.0495,0.0495],[0.7,0.195,-0.1],[0.7,0.095,0],[0.1,0.095,0],[0.095,0.1,0],[0.095,0.7,0],[0.195,0.7,-0.1],[0.0495,1,0.0495],[-0.1,0.7,0.195],[0,0.7,0.095],[0,0.1,0.095],[0,0.095,0.1],[0,0.095,0.7],[-0.1,0.195,0.7],[0.0495,0.0495,1],[0.195,-0.1,0.7],[0.095,0,0.7],[0.095,0,0.1]];var a=c.length;this.glVertexBuffer=b.createBuffer();this.glVertexBuffer.numItems=a;var e=[];for(var d=0;d<a;++d){this.addAPoint(e,c[d]);if(d<7){this.addAColor(e,[0.9,0,0,1])}else{if(d<14){this.addAColor(e,[0,0.9,0,1])}else{this.addAColor(e,[0,0,0.9,1])}}}b.bindBuffer(b.ARRAY_BUFFER,this.glVertexBuffer);b.bufferData(b.ARRAY_BUFFER,new Float32Array(e),b.STATIC_DRAW);this.prepared=true};Repere.prototype.draw=function(a){if(!(a instanceof WebGLRenderingContext)){console.error("Repere.draw: glContext is not a WebGLRenderingContext");return}if(this.glVertexBuffer===undefined){console.error("Repere.draw: prepare the repere BEFORE drawing it !");return}this.shader.setAttributes(a,this.glVertexBuffer,1);a.drawArrays(a.LINE_LOOP,0,this.glVertexBuffer.numItems)};Repere.prototype.drawBackBuffer=function(){throw"Repere is not pickable !"};Repere.prototype.unprepare=function(){};BoundingBox.prototype=new GenericStructure;BoundingBox.prototype.constructor=BoundingBox;function BoundingBox(b,a){GenericStructure.call(this,"boundingBox",new DefaultShader(a));this.dimension=b;this.isPickable=false}BoundingBox.prototype.getDimension=function(){return this.dimension};BoundingBox.prototype.setDimension=function(a){if(!checkType(arguments,[Vector,Array,"number"])){throw"BoundingBox.setDimension: bad type of parameter"}this.dimension=new Vector(a);this.prepared=false};BoundingBox.prototype.prepare=function(b){var h=(new Vector(this.dimension)).mul(1.01/Math.max(this.dimension.x,this.dimension.y,this.dimension.z));var e=[[-h.x,-h.y,-h.z],[-h.x,h.y,-h.z],[h.x,-h.y,-h.z],[h.x,h.y,-h.z],[-h.x,-h.y,h.z],[-h.x,h.y,h.z],[h.x,-h.y,h.z],[h.x,h.y,h.z],];var a=e.length;var c=[0.7,0.7,0.7,1];this.glVertexBuffer=b.createBuffer();this.glVertexBuffer.numItems=a;var g=[];for(var f=0;f<a;++f){this.addAPoint(g,e[f]);this.addAColor(g,c)}b.bindBuffer(b.ARRAY_BUFFER,this.glVertexBuffer);b.bufferData(b.ARRAY_BUFFER,new Float32Array(g),b.STATIC_DRAW);var d=[0,2,2,3,3,1,1,0,0,4,2,6,3,7,1,5,4,6,6,7,7,5,5,4];this.glIndiciesBuffer=b.createBuffer();this.glIndiciesBuffer.numItems=d.length;b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.glIndiciesBuffer);b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),b.STATIC_DRAW);this.prepared=true};BoundingBox.prototype.draw=function(a){if(!(a instanceof WebGLRenderingContext)){console.error("BoundingBox.draw: glContext is not a WebGLRenderingContext");return}if(this.glVertexBuffer===undefined||this.glIndiciesBuffer===undefined){console.error("BoundingBox.draw: prepare the box BEFORE drawing it !");return}this.shader.setRenderingMode(RenderingModeEnum.PICKING);this.shader.setAttributes(a,this.glVertexBuffer,globalParam.perspectiveView?1:0);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.glIndiciesBuffer);a.drawElements(a.LINES,this.glIndiciesBuffer.numItems,a.UNSIGNED_SHORT,0)};BoundingBox.prototype.drawBackBuffer=function(){throw"BoundingBox is not pickable !"};