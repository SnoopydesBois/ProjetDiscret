var globalParam={cubeColorDebug:false,perspectiveView:true,};function clamp(b,a,c){return Math.min(a,Math.max(b,c))}function angle(b,d){var a=Math.sqrt(b*b+d*d),c=b/a;return(d<0)?Math.acos(-c)+Math.PI:Math.acos(c)}function getAzimuth(a,b){var c=new Vector(a).sub(b);return angle(c.x,c.y)}function getAltitude(a,b){var c=new Vector(a).sub(b);return Math.asin(c.z/c.getLength())}function posToColor(c,b,a){return[c.getPosition().x/a.x,c.getPosition().y/a.y,c.getPosition().z/a.z,1-b/100]}function colorToPos(a,b){return new Facet(new Vector(Math.round(a[0]*b.x/256),Math.round(a[1]*b.y/256),Math.round(a[2]*b.z/256)),Math.round((1-a[3]/256)*100))}function addEvent(c,b,a){if(c==null||typeof(c)=="undefined"){return}if(c.addEventListener){c.addEventListener(b,a,false)}else{if(c.attachEvent){c.attachEvent("on"+b,a)}else{c["on"+b]=a}}}function type(a){switch(a){case undefined:return"undefined";case null:return"null";default:return((typeof a==="object")||(typeof a==="function")?a.constructor.name:typeof a)}}function showType(){var b="";for(var a in arguments){b+=type(arguments[a])+"; "}console.log(b)}function isA(a,b){if(b===null){return a===null}else{if(b===undefined){return a===undefined}else{if(typeof b=="string"){return typeof a==b}else{return a instanceof b}}}}function checkType(c){var b=Math.min(c.length,arguments.length-1);var d=0;var e=true;while(e&&d<b){if(arguments[d+1] instanceof Array){var f=false,g=arguments[d+1].length,a=0;while(!f&&a<g){f=f||(isA(c[d],arguments[d+1][a]));++a}}else{e=e&&(isA(c[d],arguments[d+1]))}++d}return e}function isValueOfEnum(c,b){for(var a in c){if(b==c[a]){return true}}return false};function get3DGlContext(a){var c=null;try{c=a.getContext("webgl",{preserveDrawingBuffer:true})||a.getContext("experimental-webgl",{preserveDrawingBuffer:true});c.drawingBufferWidth=a.width;c.drawingBufferHeight=a.height}catch(b){console.error("HTMLCanvasElement.getContext() FAILED !")}return c}function createShader(a,b,d){if(!(a instanceof WebGLRenderingContext&&typeof d==="string")){console.error("createShader: bad type(s) of parameter(s) !");return null}var c=null;c=a.createShader(b);a.shaderSource(c,d);a.compileShader(c);if(!a.getShaderParameter(c,a.COMPILE_STATUS)){console.error("Error compiling shader:",a.getShaderInfoLog(c));a.deleteShader(c);c=null}return c}function createProgram(b){var a=arguments.length;if(!(b instanceof WebGLRenderingContext)){console.error("createProgram: give a corect gl context !");return null}for(var d=1;d<a;++d){if(!arguments[d] instanceof WebGLShader){console.error("createProgram: one of parameter is not a WebGLShader");return null}}var c=b.createProgram();if(a>1){for(var d=1;d<a;++d){b.attachShader(c,arguments[d])}b.linkProgram(c)}if(!b.getProgramParameter(c,b.LINK_STATUS)){console.error("createProgram: failed to attach shaders");c=null}return c}function clear2DCanvas(b,c){if(!b instanceof CanvasRenderingContext2D){throw"clear2DCanvas: bad given context"}c||(c="white");var a=b.strokeStyle;b.strokeStyle=c;b.strokeRect(0,0,b.canvas.width,b.canvas.height);b.strokeStyle=a};function LoadFileSync(a){if(typeof(a)=="undefined"){return""}var b=new XMLHttpRequest();b.overrideMimeType("../text/text");b.open("GET",a,false);b.send(null);if(b.status===200||b.status===0){return b.responseText}return null}var requestAnimFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b,a){window.setTimeout(b,100/3)}})();
