<!DOCTYPE html> 
<!--
	author : abisutti
	created : Fri, 18 Dec 2015 14:11:34 +0100
	modified : Fri, 18 Dec 2015 14:11:34 +0100
-->
<html lang="fr">
	<head>
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<title>Surface de révolution discrète</title>
		<!-- TODO Modifié title pour le mutilangue -->
		
		<!-- javascript imports -->
		<script type="text/javascript" src="Js/Utils/function.js"></script>
		<script type="text/javascript" src="Js/Utils/webglFunction.js"></script>
		<script type="text/javascript" src="Js/Utils/Util.js"></script>
		
		<script type="text/javascript" src="Js/Enum/AxisEnum.js"></script>
		<script type="text/javascript" src="Js/Enum/AttributeEnum.js"></script>
		<script type="text/javascript" src="Js/Enum/RenderingModeEnum.js"></script>
		<script type="text/javascript" src="Js/Enum/CubeStateEnum.js"></script>
		<script type="text/javascript" src="Js/Enum/MenuEntryEnum.js"></script>
		<script type="text/javascript" src="Js/Enum/DirectionEnum.js"></script>
		<script type="text/javascript" src="Js/Enum/ConnexityEnum.js"></script>
		
		<script type="text/javascript" src="Js/Libraries/math.js"></script>
		<script type="text/javascript" src="Js/Libraries/jquery.js"></script>
		<script type="text/javascript" src="Js/Libraries/jquery-ui.js"></script>
		<script type="text/javascript" src="Js/Libraries/jszip.js"></script>
		<script type="text/javascript" src="Js/Libraries/FileSaver.js"></script>
		<script type="text/javascript" src="Js/Libraries/webgl-debug.js"></script>
		
		<script type="text/javascript" src="Js/Objects/Range.js"></script>
		<script type="text/javascript" src="Js/Objects/Equation.js"></script>
		<script type="text/javascript" src="Js/Objects/Camera.js"></script>
		<script type="text/javascript" src="Js/Objects/Vector.js"></script>
		<script type="text/javascript" src="Js/Objects/Matrix.js"></script>
		<script type="text/javascript" src="Js/Objects/Point.js"></script>
		<script type="text/javascript" src="Js/Objects/Voxel.js"></script>
		<script type="text/javascript" src="Js/Objects/Facet.js"></script>
		<script type="text/javascript" src="Js/Objects/Surface.js"></script>
		<script type="text/javascript" src="Js/Objects/Curve.js"></script>
		<script type="text/javascript" src="Js/Objects/FormulaCurve.js"></script>
		<script type="text/javascript" src="Js/Objects/ImplicitCurve.js"></script>
		<script type="text/javascript" src="Js/Objects/ExplicitCurve.js"></script>
		<script type="text/javascript" src="Js/Objects/GenericStructure.js"></script>
		<script type="text/javascript" src="Js/Objects/Scene.js"></script>
		<script type="text/javascript" src="Js/Objects/GenericViewer.js"></script>
		<script type="text/javascript" src="Js/Objects/Repere.js"></script>
		
		<script type="text/javascript" src="Js/Shader/Shader.js"></script>
		<script type="text/javascript" src="Js/Shader/DefaultShader.js"></script>
		
		<script type="text/javascript" src="Js/Controllers/Controller.js"></script>
		<script type="text/javascript" src="Js/Controllers/Controller3D.js"></script>
		<script type="text/javascript" src="Js/Controllers/ControllerCamera.js"></script>
		
		<script type="text/javascript" src="Js/Functionalities/ModelGen.js"></script>
		
		<script type="text/javascript" src="Js/Display/SurfaceRenderer.js"></script>
		<script type="text/javascript" src="Js/Display/SurfaceViewer.js"></script>
		<script type="text/javascript" src="Js/Display/CurveRenderer.js"></script>
		
<!--		<script type="text/javascript" src="Js/Display/Display.js"></script>-->
<!--		<script type="text/javascript" src="Js/Display/Display2D.js"></script>-->
<!--		<script type="text/javascript" src="Js/Display/Display3D.js"></script>-->
<!--		<script type="text/javascript" src="Js/Display/ModelView.js"></script>-->
<!--		<script type="text/javascript" src="Js/Display/SurfaceView.js"></script>-->
		
		<script type="text/javascript" src="Js/Interface/EntryData.js"></script>
		<script type="text/javascript" src="Js/Interface/UndoRedoAction.js"></script>
		<script type="text/javascript" src="Js/Interface/ListUndoRedoAction.js"></script>
		<script type="text/javascript" src="Js/Interface/Application.js"></script>
		<script type="text/javascript" src="Js/Interface/Application_Tools.js"></script>
		<script type="text/javascript" src="Js/Interface/Application_Controller.js"></script>
		<script type="text/javascript" src="Js/Interface/Application_Messages.js"></script>
		<script type="text/javascript" src="Js/Interface/Application_Interface.js"></script>
		<script type="text/javascript" src="Js/Interface/Application_Initialisation.js"></script>
		<script type="text/javascript" src="Js/Interface/Application_Colors.js"></script>
		
		<script type="text/javascript" src="translatemodule/main.js"></script>
		
		<!-- css imports -->
		<link rel="stylesheet" type="text/css" media="all" href="Styles/temp.css"/>
		<link rel="stylesheet" type="text/css" media="all" href="Styles/common.css"/>
		<link rel="stylesheet" type="text/css" media="all" href="Styles/general.css"/>
		<link rel="stylesheet" type="text/css" media="all" href="Styles/menus.css"/>
		<link rel="stylesheet" type="text/css" media="all" href="Styles/style2.css">
		
		<!-- shader -->
		<script id="shader-vs" type="x-shader/x-vertex">
			attribute vec3 aPosition;
			attribute vec4 aColor;

			uniform mat4 uProjectionMatrix;
			uniform mat4 uModelViewMatrix;

			varying vec4 vColor;
			varying vec3 vPos;

			void main (void) {
				gl_Position = uProjectionMatrix * uModelViewMatrix * vec4 (aPosition, 1.0);
				vPos = aPosition;
				vColor = aColor;
			}
		</script>
		<script id="shader-fs" type="x-shader/x-fragment">
			precision mediump float;

			varying vec4 vColor;
			varying vec3 vPos;

			uniform int uMode;


			void main (void) {
				vec4 tight = vec4 (0.05, 0.95, 0.05, 0.95); // values
				if (uMode == 1) { // Rendering the repere (DOTTED = 1)
					 // Pixel coordinates on the screen
					vec3 pos = ((vPos + 1.0) / 2.0) * 25.0;
					bool dot = false;
		
					int nb = 0; // We count the number of coordinates that are integers
					// X axis
					if (step(tight[2], fract(pos.x)) == 0.0 
						|| step(tight[3], fract(pos.x)) == 1.0) {
						nb++;
					}
					else if (mod(fract(pos.x), 0.4) > 0.2) {
						dot = true;
					}
					
					// Y axis
					if (step(tight[2], fract(pos.y)) == 0.0 
						|| step(tight[3], fract(pos.y)) == 1.0) {
						nb++;
					}
					else if (mod(fract(pos.y), 0.4) > 0.2) {
						dot = true;
					}
					
					// Z axis
					if (step(tight[2], fract(pos.z)) == 0.0 
						|| step(tight[3], fract(pos.z)) == 1.0) {
						nb++;
					}
					else if (mod(fract(pos.z), 0.4) > 0.2) {
						dot = true;
					}
		
					// If there is only one integer coordinate, we render normally
					if (nb >= 2 && !dot) {
						float colorX = vColor.x * 1.8;
						float colorY = vColor.y * 1.8;
						float colorZ = vColor.z * 1.8; 
						gl_FragColor = vec4 (colorX, colorY, colorZ, 1.0);
					}
					// The pixel is on a line, we draw
					else {
						gl_FragColor = vColor;
					}
				}
				else if (uMode == 2) { // If picking we render the model without lines (PICKING = 2)
					gl_FragColor = vColor;
				}
				else {
					 // Pixel coordinates on the screen
					vec3 pos = ((vPos + 1.0) / 2.0) * 3.0;

					int nb = 0; // We count the number of coordinates that are integers
					if (step(tight[0], fract(pos.x)) == 0.0 
						|| step(tight[1], fract(pos.x)) == 1.0) {
						nb++;
					}
	
					if (step(tight[0], fract(pos.y)) == 0.0 
						|| step(tight[1], fract(pos.y)) == 1.0) {
						nb++;
					}
	
					if (step(tight[0], fract(pos.z)) == 0.0 
						|| step(tight[1], fract(pos.z)) == 1.0) {
						nb++;
					}
					// If there is only one integer coordinate, we render normally
					if (nb < 2) {
						gl_FragColor = vColor;
					}
					else {
						// The pixel is on a line, we draw more darkly
						float colorX = vColor.x * 0.7;
						float colorY = vColor.y * 0.7;
						float colorZ = vColor.z * 0.7; 
			
						gl_FragColor = vec4 (colorX, colorY, colorZ, 1.0);
					}
				} // end switch uMode
			}
		</script>
	</head>
	<body>
		<!-- Menus -->
		<ul class="menus header">
			<li id="fileMenu" tabindex="1">
				<h1 key="home" class="tr">Fichier</h1>
				<ul>
					<li title="Créer un nouveau modèle"
						onclick="" key="home" class="tr">Nouveau</li>

					<li title="Ouvrir un modèle depuis un fichier sur cet ordinateur"
						onclick="this.firstElementChild.click()">
						<input type="file" id="i_file" onchange=""
							style="display:none">Ouvrir</input>
					</li>
					<li title="Enregistrer le modèle actuel" 
						onclick="">Enregistrer</li>
					<li title="Fermer le modèle">Fermer</li>
				</ul>
			</li><!-- because inline-block put a small space between blocks
			--><li id="viewMenu" tabindex="2">
				<h1>Affichage</h1>
				<ul>
					<li title="Générer la surface dans la vue 3D" 
						onclick="appli.surfaceView.showScene ()">Générer</li>
				</ul>
			</li><!-- because inline-block put a small space between blocks
			--><li id="toolsMenu" tabindex="3">
				<h1>Outils</h1>
				<ul>
					<li id="toolUndo"
						class="inaccessible"
						title="Annuler la dernière action effectuée" 
						onclick="">Annuler</li>
					
					<li id="toolRedo"
						class="inaccessible"
						title="Refaire la dernière action annulée" 
						onclick="">Refaire</li>
					
					<li class="split"><hr/></li>
					
					<li title="Outils pour ajouter des cubes" 
						onclick="">Ajouter des cubes</li>
					
					<li title="Outils pour supprimer des cubes" 
						onclick="">Supprimer des cubes</li>
					
					<li class="split"><hr/></li>
					
					<li title="Déplacer la forme"
						onclick="">Déplacer</li>
					
					<li class="submenu" title="Tourner le modèle">
						<h1>Tourner</h1>
						<ul>
							<li class="submenu">
								<h1>Axe X</h1>
								<ul>
									<li title="Tourner de 90° suivant l'axe X"
										onclick="">90°</li>
									<li title="Tourner de 180° suivant l'axe X"
										onclick="">180°</li>
									<li title="Tourner de 270° suivant l'axe X"
										onclick="">270°</li>
								</ul>
							</li>
							<li class="submenu">
								<h1>Axe Z</h1>
								<ul>
									<li title="Tourner de 90° suivant l'axe Z">90°</li>
									<li title="Tourner de 180° suivant l'axe Z">180°</li>
									<li title="Tourner de 270° suivant l'axe Z">270°</li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
			</li><!-- because inline-block put a small space between blocks
			--><li id="helpMenu" tabindex="5">
				<h1>Aide</h1>
				<ul>
					<li>Afficher l'aide</li>
					<li>À propos</li>
				</ul>
			</li>
			
			<li id="translatemenu" tabindex="6">
			<h1>Traduction</h1>
				<ul>
				 <!-- <div class="lang_switcher">-->
                <li id="en" class="lang">EN</li>
                <li id="ru" class="lang">RU</li>
            <!-- </div> -->
				</ul>
			</li>
		</ul><!-- end menus -->
		
		
		<!-- Workspace -->
		<div id="workspace">
			<div id="curvesView">
				<div id="meridianView">
					<div id="meridianParam" class="paramPanel">
						Liste des paramètres Méridienne
					</div>
					<canvas id="meridianCanvas"></canvas>
					<div id="meridianOption" class="optionPanel">
						Option Méridienne
					</div>
				</div>
				<div id="revolutionView">
					<div id="revolutionParam" class="paramPanel">
						Liste des paramètres Révolution
					</div>
					<canvas id="revolutionCanvas"></canvas>
					<div id="revolutionOption" class="optionPanel">
						Option Révolution
					</div>
				</div>
			</div>
			<div id="surfaceView">
				<div id="surfaceParam" class="paramPanel">
					<button onclick="appli.surfaceView.showScene ();">Générer</button>
					<hr/>
					<button onclick="cam.eyePos.x = -cam.eyePos.x;appli.surfaceView.showScene ();">Flip X</button>
					<button onclick="cam.eyePos.y = -cam.eyePos.y;appli.surfaceView.showScene ();">Flip Y</button>
					<button onclick="cam.eyePos.z = -cam.eyePos.z;appli.surfaceView.showScene ();">Flip Z</button>
					Liste des paramètres Surface
				</div>
				<canvas id="surfaceCanvas" width="640" height="480"></canvas>
				<div id="surfaceOption" class="optionPanel">
					Option Surface
				</div>
			</div>
		</div>
		
		
		<!-- State bar -->
		<div id="stateBar" class="footer">
			<p>Message...</p>
		</div>
		
		<script type="text/javascript">
			var dim = new Vector (3, 3, 3);
			var s = new Surface (dim);
			for (var x = 0; x < dim.x; ++x)
				for (var y = 0; y < dim.y; ++y)
					for (var z = 0; z < dim.z; ++z)
						if ((x+y+z) == 3 || (x+y+z) == 4)
							s.addVoxel (new Vector (x, y, z));
/*			var ss = "";
			for (var x = 0; x < dim.x; ++x) {
				for (var y = 0; y < dim.y; ++y) {
					ss = "";
					for (var z = 0; z < dim.z; ++z) {
						ss += (s.matVoxel[x][y][z] == null ? "0 " : "1 "); 
					}
					console.log (ss);
				}
				console.log ("");
			}*/
			var appli = new Application ();
			var forme = new SurfaceRenderer (new Controller3D (dim, s), appli.surfaceView.glContext);
			forme.modelController.modelGen.surface = s;
			appli.surfaceView.scene.addObject (forme);
			var cam = new Camera (
				new Vector (-10, 3, 5),
				new Vector (0, 0, 0),
				new Vector (0, 0, 1),
				400, 300,
				30.0, 0.1, 100.0
			);
			appli.surfaceView.scene.setCamera (cam);
			appli.surfaceView.scene.setScale (0.9);
			var gl = appli.surfaceView.glContext;
			gl.enable(gl.CULL_FACE);
			gl.enable(gl.DEPTH_TEST);
			gl.frontFace(gl.CW);
			appli.initAppli ();
			
			/* voir
			http://webglfundamentals.org/webgl/lessons/webgl-drawing-multiple-things.html
			http://stackoverflow.com/questions/24538310/the-difference-between-glortho-and-glviewport-in-opengl
			*/
		</script>
	</body>
</html>


